<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Mahalle Efsaneleri: EJDER OTOBANI</title>
    <style>
        :root { --grass: #2d5a27; --dirt: #4b3621; --stone: #444; --gold: #ff9d00; --loot: #a020f0; --boss: #8b0000; }
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        
        #day-night-overlay { position: fixed; inset: 0; pointer-events: none; z-index: 8000; transition: background 5s; background: rgba(0,0,30,0); }
        
        #ui-top { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.95); padding: 10px; z-index: 9000; border-bottom: 2px solid white; display: flex; flex-direction: column; align-items: center; }
        .stat-row { display: flex; gap: 15px; font-size: 14px; margin-bottom: 5px; }
        #xp-container { width: 80%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        #xp-fill { width: 0%; height: 100%; background: #00e5ff; }
        
        #quest-panel { position: fixed; top: 120px; left: 10px; background: rgba(0,0,0,0.85); border: 1px solid var(--gold); padding: 10px; z-index: 5000; min-width: 200px; font-size: 13px; }

        #shop-ui, #battle-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        
        .hp-bar { width: 350px; height: 25px; background: #333; border: 2px solid white; margin: 5px 0; position: relative; }
        .hp-text { position: absolute; width: 100%; text-align: center; line-height: 25px; font-weight: bold; text-shadow: 1px 1px 2px black; z-index: 2; }
        
        #dodge-zone { width: 350px; height: 40px; border: 2px solid #fff; position: relative; background: #222; display: none; margin: 20px 0; }
        #dodge-target { position: absolute; width: 50px; height: 100%; background: lime; left: 150px; }
        #dodge-cursor { position: absolute; width: 6px; height: 100%; background: #fff; }
        
        button { background: #000; color: var(--gold); border: 2px solid var(--gold); padding: 10px 20px; cursor: pointer; margin: 5px; font-weight: bold; transition: 0.2s; }
        button:hover { background: var(--gold); color: #000; }
        
        #game-container { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        #world { position: absolute; width: 4000px; height: 4000px; background: var(--grass); z-index: 1; border: 20px solid #1a3317; }
        
        .village-area { position: absolute; background: var(--dirt); border-radius: 20px; z-index: 2; }
        
        /* KALE ALANI */
        .castle-area { position: absolute; background: var(--stone); border: 10px solid #222; z-index: 2; }
        .castle-gate { position: absolute; width: 100px; height: 20px; background: #000; border: 2px solid red; z-index: 5; text-align: center; color: red; font-size: 10px; cursor: pointer; }
        .inner-gate { position: absolute; width: 60px; height: 60px; background: #220000; border: 2px solid red; z-index: 5; text-align: center; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 30px; }
        
        .tree { position: absolute; font-size: 40px; transform: translate(-50%, -100%); z-index: 10; pointer-events: none; }
        .fruit { position: absolute; font-size: 25px; cursor: pointer; z-index: 15; animation: bounce 1s infinite; }
        
        #player { width: 30px; height: 30px; background: red; border-radius: 50%; position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); box-shadow: 0 0 20px red; z-index: 1000; }
        .npc { width: 45px; height: 45px; border-radius: 50%; border: 2px solid white; cursor: pointer; position: absolute; z-index: 20; transform: translate(-50%, -50%); }
        .npc-label { position: absolute; top: -45px; width: 120px; text-align: center; left: -38px; font-weight: bold; font-size: 12px; text-shadow: 2px 2px #000; }
        
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    </style>
</head>
<body>

    <div id="day-night-overlay"></div>

    <div id="ui-top">
        <div class="stat-row">
            <span>â¤ <b id="st-hp">100/100</b></span>
            <span>ğŸ’° <b id="st-gold">100</b></span>
            <span>â­ LVL: <b id="st-lvl">1</b></span>
            <span style="color:var(--loot)">ğŸ’ GANÄ°MET: <b id="st-loot">0</b></span>
            <span id="st-time" style="color:yellow">â˜€ï¸ GÃœNDÃœZ</span>
        </div>
        <div id="xp-container"><div id="xp-fill"></div></div>
    </div>

    <div id="quest-panel">
        <b style="color:var(--gold)">GÃ–REVLER</b>
        <div id="q-list">NPC'lerden gÃ¶rev al!</div>
    </div>

    <div id="shop-ui">
        <h2 style="color:orange">TOSTÃ‡U YAKUP - MARKET</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; max-width:600px">
            <button onclick="buy('sis', 1000)">âš”ï¸ 18 Cmlik ÅiÅŸ (+50 Dmg) - 1000G</button>
            <button onclick="buy('zirh', 750)">ğŸ›¡ï¸ Demir ZÄ±rh (-15 Dmg) - 750G</button>
            <button onclick="buy('glove', 400)">ğŸ§¤ Ganimet Eldiveni - 400G</button>
            <button onclick="buy('key', 5000)">ğŸ”‘ KALE ANAHTARI - 5000G</button>
            <button onclick="buy('tost', 500)">ğŸ¥ª YarÄ±m Ekmek (+50 MaxHP) - 500G</button>
            <button onclick="sellLoot()" style="color:var(--loot)">ğŸ’ Ganimet Sat (50G)</button>
        </div>
        <br>
        <button onclick="document.getElementById('shop-ui').style.display='none'" style="width:100%">DÃœKKANI KAPAT</button>
    </div>

    <div id="battle-screen">
        <h2 id="btl-name" style="color:red"></h2>
        <div class="hp-bar"><div class="hp-text"><span id="txt-enemy-hp"></span></div><div id="btl-enemy-hp" style="height:100%; background:red; width:100%; transition:0.2s"></div></div>
        <div id="btl-sprite" style="white-space:pre; font-family:monospace; margin:20px; font-size:16px; line-height:16px; text-align:center;"></div>
        <div id="battle-log" style="color:yellow; height:30px; font-weight:bold; font-size:18px"></div>
        <div id="dodge-zone"><div id="dodge-target"></div><div id="dodge-cursor"></div><button onclick="attemptDodge()" style="position:absolute; right:-90px; background:lime; color:black">REFLEKS!</button></div>
        <div id="btl-btns">
            <button onclick="combat('attack')">ğŸ—¡ SALDIR</button>
            <button onclick="combat('run')">ğŸƒ KAÃ‡</button>
            <button onclick="combat('heal')">ğŸ• YEMEK YE</button>
        </div>
        <div class="hp-bar"><div class="hp-text"><span id="txt-player-hp"></span></div><div id="btl-player-hp" style="height:100%; background:lime; width:100%; transition:0.2s"></div></div>
    </div>

    <div id="game-container">
        <div id="world"></div>
        <div id="player"></div>
    </div>

<script>
    const state = {
        wX: 1500, wY: 1500, tX: 1500, tY: 1500,
        hp: 100, maxHp: 100, gold: 100, lvl: 1, xp: 0, loot: 0,
        hasGlove: false, hasSis: false, defense: 0, 
        hasKey: false, // Kale GiriÅŸ AnahtarÄ±
        hasInnerKey: false, // Darius'tan dÃ¼ÅŸen anahtar
        dariusDead: false,
        
        isNight: false, timeCount: 0,
        isBattle: false, isTurn: true,
        
        quests: { zeynep: 0, miray: 0, ipek: 0 },
        qLvl: { zeynep: 1, miray: 1, ipek: 1 },
        qActive: { zeynep: false, miray: false, ipek: false }
    };

    // BÃ¶lge 1 DÃ¼ÅŸmanlarÄ±
    const mobsVillage = [
        { id:'normal', name: "LaÄŸÄ±m Faresi YaÄŸÄ±z", hp: 60, atk: 15, lvl: 1, art: "(q\\---/p)\n ( o o )" },
        { id:'normal', name: "Pasif Salih", hp: 150, atk: 25, lvl: 3, art: "(- _ -)\n--|   |--" },
        { id:'normal', name: "At KazÄ±m", hp: 450, atk: 45, lvl: 6, art: "/\\___/\\\n( o o )" }
    ];

    // BÃ¶lge 2 (Kale) DÃ¼ÅŸmanlarÄ±
    const mobsCastle = [
        { id:'normal', name: "Tekno MiraÃ§", hp: 800, atk: 70, lvl: 10, art: "[O_O]\n/|Lazer|\\" },
        { id:'normal', name: "Abla Ã–mer", hp: 950, atk: 85, lvl: 12, art: "(~.~)\n<Terlik>" },
        { id:'normal', name: "KaslÄ± Ä°bo", hp: 1200, atk: 100, lvl: 14, art: "/'''\\\n( O O )\n/DAMBIL\\" }
    ];

    // BOSS VERÄ°LERÄ°
    const bossDarius = { id:'darius', name: "KORUYAN DARIUS", hp: 3000, atk: 150, lvl: 20, art: "  /---\\\n | 0 0 |\n--|XXX|--\n  |   |" };
    const bossMahmut = { 
        id:'mahmut', name: "EJDER OTOBANI MAHMUT", hp: 6000, atk: 200, lvl: 30, 
        phase: 1,
        art1: "   /\\_/\\\n  ( o.o )\n >|ZIRH|<", 
        art2: "   /\\_/\\\n  ( O.O )\n >|KIRIK|<", 
        art3: "   /\\_/\\\n  ( X.X )\n >|DELÄ°|<" 
    };

    function init() {
        const w = document.getElementById('world');
        
        // KÃ¶y
        w.innerHTML += `<div class="village-area" style="width:800px; height:800px; left:1100px; top:1100px"></div>`;
        
        // Kale AlanÄ± (SaÄŸ Ãœst)
        w.innerHTML += `<div class="castle-area" style="width:1000px; height:1000px; left:2200px; top:200px"></div>`;
        
        // Kale KapÄ±sÄ± (GiriÅŸ)
        let gate = document.createElement('div');
        gate.className = 'castle-gate'; gate.style.left = '2650px'; gate.style.top = '1180px';
        gate.innerText = "KÄ°LÄ°TLÄ° KAPI (ANAHTAR LAZIM)";
        gate.onclick = (e) => enterCastle(e);
        w.appendChild(gate);

        // Ä°Ã§ KapÄ± (Darius & Mahmut)
        let innerGate = document.createElement('div');
        innerGate.className = 'inner-gate'; innerGate.style.left = '2670px'; innerGate.style.top = '300px';
        innerGate.innerText = "ğŸ‘¹";
        innerGate.onclick = (e) => fightBoss(e);
        w.appendChild(innerGate);

        spawnNPC('yakup', 'TostÃ§u Yakup', 1500, 1600, 'orange', 'MARKET');
        spawnNPC('zeynep', 'Zeynep', 1300, 1300, 'blue', 'SAVAÅÃ‡I');
        spawnNPC('miray', 'Miray', 1700, 1300, 'pink', 'BAHÃ‡IVAN');
        spawnNPC('ipek', 'Ä°pek', 1500, 1200, 'purple', 'AÅÃ‡I');
        
        // AÄŸaÃ§lar
        for(let i=0; i<60; i++) {
            let x = Math.random()*3500+100, y = Math.random()*3500+100;
            // Kalenin iÃ§ine aÄŸaÃ§ koyma
            if(x > 2200 && x < 3200 && y > 200 && y < 1200) continue; 
            
            let t = document.createElement('div'); t.className = 'tree';
            t.style.left = x+'px'; t.style.top = y+'px'; t.innerText = 'ğŸŒ²'; w.appendChild(t);
            if(Math.random() < 0.3) {
                let f = document.createElement('div'); f.className = 'fruit';
                f.style.left = (x+20)+'px'; f.style.top = (y+20)+'px'; f.innerText = Math.random() > 0.5 ? 'ğŸ' : 'ğŸ“';
                f.onclick = (e) => { e.stopPropagation(); f.remove(); if(state.qActive.miray) { state.quests.miray++; checkQuestCompletion('miray'); } };
                w.appendChild(f);
            }
        }
        setInterval(updateTime, 1000); 
        updateUI(); updateQuestUI(); loop();
    }

    function updateTime() {
        state.timeCount++;
        if(state.timeCount % 30 === 0) {
            state.isNight = !state.isNight;
            document.getElementById('day-night-overlay').style.background = state.isNight ? "rgba(0,0,50,0.7)" : "rgba(0,0,0,0)";
            document.getElementById('st-time').innerText = state.isNight ? "ğŸŒ™ GECE" : "â˜€ï¸ GÃœNDÃœZ";
        }
    }

    function enterCastle(e) {
        e.stopPropagation();
        if(state.hasKey) {
            alert("AnahtarÄ± kullandÄ±n. KALE KAPISI AÃ‡ILDI! Dikkatli ol...");
            e.target.style.display = 'none'; // KapÄ±yÄ± kaldÄ±r
        } else {
            alert("KapÄ± kilitli! TostÃ§u Yakup'tan anahtar almalÄ±sÄ±n (5000 Gold).");
        }
    }

    function fightBoss(e) {
        e.stopPropagation();
        if(!state.hasKey) { alert("Ã–nce kaleye girmen lazÄ±m!"); return; }

        if(!state.dariusDead) {
            startBattle(bossDarius);
        } else {
            if(state.hasInnerKey) {
                if(confirm("EJDER ODASINA GÄ°RMEK Ä°STÄ°YOR MUSUN? GERÄ° DÃ–NÃœÅ YOK!")) {
                    startBattle(bossMahmut);
                }
            } else {
                alert("Darius Ã¶ldÃ¼ ama anahtarÄ± almadÄ±n mÄ±?");
            }
        }
    }

    function spawnNPC(id, name, x, y, color, job) {
        let d = document.createElement('div'); d.className = 'npc';
        d.style.left = x+'px'; d.style.top = y+'px'; d.style.backgroundColor = color;
        d.innerHTML = `<div class="npc-label" style="color:${color}">${name}<br><small style="color:white">${job}</small></div>`;
        d.onclick = (e) => { 
            e.stopPropagation(); 
            if(id==='yakup') document.getElementById('shop-ui').style.display='flex'; 
            else { 
                if(!state.qActive[id]) { state.qActive[id] = true; alert(`${name}: GÃ¶rev verildi!`); }
                else alert(`${name}: Acele et!`);
                updateQuestUI();
            } 
        };
        document.getElementById('world').appendChild(d);
    }

    function checkQuestCompletion(npc) {
        let t = (npc==='ipek'?3:npc==='miray'?5:3) * state.qLvl[npc];
        if(state.quests[npc] >= t) {
            let rw = state.qLvl[npc]*300; state.gold += rw; state.quests[npc]=0; state.qLvl[npc]++;
            alert(`GÃ–REV BÄ°TTÄ°! +${rw} Gold`); updateUI();
        }
        updateQuestUI();
    }

    function buy(type, price) {
        if(state.gold < price) return alert("Para yetmiyor!");
        if(type === 'sis') { if(state.hasSis) return alert("Var zaten"); state.hasSis=true; }
        if(type === 'zirh') { if(state.defense>0) return alert("Var zaten"); state.defense=15; }
        if(type === 'glove') { if(state.hasGlove) return alert("Var zaten"); state.hasGlove=true; }
        if(type === 'key') { if(state.hasKey) return alert("Var zaten"); state.hasKey=true; }
        if(type === 'tost') { state.maxHp+=50; state.hp=state.maxHp; }
        state.gold -= price; updateUI(); alert("SatÄ±n alÄ±ndÄ±!");
    }

    function sellLoot() {
        if(state.loot<=0) return alert("Ganimet yok!");
        state.gold += state.loot*50; state.loot=0; updateUI();
    }

    function loop() {
        if(!state.isBattle) {
            let dx = state.tX - state.wX, dy = state.tY - state.wY;
            if(Math.hypot(dx, dy) > 5) {
                state.wX += dx * 0.05; state.wY += dy * 0.05;
                
                // Kale sÄ±nÄ±rlarÄ± (2200, 200) -> (3200, 1200)
                let inCastle = (state.wX > 2200 && state.wX < 3200 && state.wY > 200 && state.wY < 1200);
                
                // Kilitli kapÄ± engeli (Key yoksa kaleye giremez)
                if(!state.hasKey && inCastle) {
                     state.wX -= dx*0.1; state.wY -= dy*0.1; // Geri it
                }

                if(Math.random() < 0.012) {
                    if(inCastle) startBattle(null, 'castle');
                    else if(!(state.wX>1100 && state.wX<1900 && state.wY>1100 && state.wY<1900)) startBattle(null, 'village');
                }
            }
            document.getElementById('world').style.transform = `translate(${window.innerWidth/2 - state.wX}px, ${window.innerHeight/2 - state.wY}px)`;
        }
        requestAnimationFrame(loop);
    }

    let curE;

    function startBattle(bossObj, zone) {
        state.isBattle = true; state.isTurn = true;
        
        if(bossObj) {
            // Boss KopyasÄ±
            curE = JSON.parse(JSON.stringify(bossObj));
            curE.curHp = curE.hp; curE.maxHp = curE.hp;
            // Art fix for Mahmut
            if(curE.id === 'mahmut') curE.art = bossMahmut.art1;
        } else {
            // Rastgele Mob
            let list = (zone === 'castle') ? mobsCastle : mobsVillage;
            let base = list[Math.floor(Math.random()*list.length)];
            curE = { ...base, curHp: base.hp, maxHp: base.hp };
        }
        
        document.getElementById('battle-screen').style.display = 'flex';
        document.getElementById('btl-btns').style.display = 'block';
        document.getElementById('btl-name').innerText = curE.name;
        document.getElementById('btl-sprite').innerText = curE.art;
        document.getElementById('battle-log').innerText = curE.name + " SANA BAKIYOR!";
        updateBattleUI();
    }

    function combat(act) {
        if(!state.isTurn) return; 

        if(act === 'run') {
            if(curE.id === 'darius' || curE.id === 'mahmut') {
                document.getElementById('battle-log').innerText = "BOSS SAVAÅINDAN KAÃ‡AMAZSIN!";
                return;
            }
            state.isBattle = false; document.getElementById('battle-screen').style.display = 'none';
            return;
        }

        state.isTurn = false; document.getElementById('btl-btns').style.display = 'none';

        if(act === 'attack') {
            // MAHMUT PHASE 3: DODGE MEKANÄ°ÄÄ°
            if(curE.id === 'mahmut' && curE.phase === 3 && Math.random() < 0.25) {
                document.getElementById('battle-log').innerText = "MAHMUT SALDIRIDAN KAÃ‡TI! (MISS)";
            } else {
                let dmg = 25 + (state.lvl * 10) + (state.hasSis ? 50 : 0);
                curE.curHp -= dmg;
                document.getElementById('battle-log').innerText = "VURDUN: " + dmg;
                
                // MAHMUT PHASE KONTROL
                if(curE.id === 'mahmut') checkMahmutPhase();

                if(curE.curHp <= 0) return victory();
            }
        } 
        else if(act === 'heal') {
            state.hp = Math.min(state.maxHp, state.hp + 40);
            if(state.qActive.ipek) { state.quests.ipek++; checkQuestCompletion('ipek'); }
            document.getElementById('battle-log').innerText = "CANLANDIN (+40)";
        }

        updateBattleUI(); setTimeout(enemyTurn, 1000);
    }

    function checkMahmutPhase() {
        let pct = curE.curHp / curE.maxHp;
        if(curE.phase === 1 && pct < 0.7) {
            curE.phase = 2; curE.art = bossMahmut.art2; curE.atk += 50;
            alert("MAHMUT'UN ZIRHI KIRILDI! (PHASE 2)");
        }
        if(curE.phase === 2 && pct < 0.3) {
            curE.phase = 3; curE.art = bossMahmut.art3; curE.atk += 100;
            alert("MAHMUT DELÄ°RDÄ°! ARTIK Ã‡OK HIZLI! (PHASE 3)");
        }
        document.getElementById('btl-sprite').innerText = curE.art;
    }

    function enemyTurn() {
        // Dodge Zone (Refleks Oyunu)
        document.getElementById('dodge-zone').style.display = 'block';
        window.dActive = true; window.dPos = 0; 
        // Mahmut 3. evrede Ã§ok hÄ±zlÄ± (speed 15)
        let speedBase = (curE.id==='mahmut' && curE.phase===3) ? 15 : (6 + curE.lvl);
        window.dDir = speedBase;
        
        function m() { 
            if(!window.dActive) return; 
            window.dPos += window.dDir; 
            if(window.dPos>344 || window.dPos<0) window.dDir*=-1; 
            document.getElementById('dodge-cursor').style.left=window.dPos+'px'; 
            requestAnimationFrame(m); 
        }
        m();
    }

    function attemptDodge() {
        window.dActive = false; document.getElementById('dodge-zone').style.display = 'none';
        let nightMult = state.isNight ? 2 : 1;
        
        if(window.dPos >= 150 && window.dPos <= 200) {
             document.getElementById('battle-log').innerText = "SIYRILDIN!";
        } else {
            let dmg = (curE.atk * nightMult) - state.defense;
            if(dmg < 1) dmg = 1;
            state.hp -= dmg;
            document.getElementById('battle-log').innerText = "HASAR YEDÄ°N: " + dmg;
        }
        
        updateBattleUI();
        if(state.hp <= 0) return respawn();
        setTimeout(() => { state.isTurn = true; document.getElementById('btl-btns').style.display = 'block'; }, 1000);
    }

    function victory() {
        let goldGain = curE.lvl * 20;
        state.gold += goldGain; state.xp += curE.lvl * 50;
        
        if(state.qActive.zeynep && curE.name.includes("YaÄŸÄ±z")) { state.quests.zeynep++; checkQuestCompletion('zeynep'); }
        if(state.hasGlove && curE.id==='normal') { state.loot++; } // Sadece normal moblardan loot dÃ¼ÅŸsÃ¼n

        // BOSS Ã–DÃœLLERÄ°
        if(curE.id === 'darius') {
            state.dariusDead = true;
            state.hasInnerKey = true;
            alert("DARIUS Ã–LDÃœ! 'Ejder AnahtarÄ±' dÃ¼ÅŸtÃ¼. Åimdi kapÄ±dan geÃ§ebilirsin.");
        }
        if(curE.id === 'mahmut') {
            alert("TEBRÄ°KLER! EJDER OTOBANI MAHMUT'U YENDÄ°N!\nMAHALLE EFSANELERÄ° BÄ°TTÄ°!\n\nSen gerÃ§ek bir Babaprosun!");
        }

        if(state.xp >= state.lvl * 500) { state.lvl++; state.xp=0; state.maxHp+=50; state.hp=state.maxHp; alert("LEVEL UP!"); }
        
        state.isBattle = false; document.getElementById('battle-screen').style.display = 'none';
        updateUI();
    }

    function respawn() { 
        state.hp = 50; state.wX = 1500; state.wY = 1600; 
        state.isBattle = false; document.getElementById('battle-screen').style.display = 'none'; 
        updateUI(); alert("BAYILDIN! KÃ¶ye dÃ¶ndÃ¼n.");
    }

    function updateQuestUI() {
        let h = "";
        if(state.qActive.zeynep) h += `<div>Zeynep: Fare (${state.quests.zeynep}/${state.qLvl.zeynep*3})</div>`;
        if(state.qActive.miray) h += `<div>Miray: Meyve (${state.quests.miray}/${state.qLvl.miray*5})</div>`;
        if(state.qActive.ipek) h += `<div>Ä°pek: Yemek (${state.quests.ipek}/${state.qLvl.ipek*3})</div>`;
        document.getElementById('q-list').innerHTML = h || "NPC'lere git!";
    }

    function updateUI() {
        document.getElementById('st-hp').innerText = state.hp + "/" + state.maxHp;
        document.getElementById('st-gold').innerText = state.gold;
        document.getElementById('st-lvl').innerText = state.lvl;
        document.getElementById('st-loot').innerText = state.loot;
        document.getElementById('xp-fill').style.width = (state.xp / (state.lvl*500)) * 100 + "%";
    }

    function updateBattleUI() {
        document.getElementById('btl-enemy-hp').style.width = Math.max(0, (curE.curHp / curE.maxHp) * 100) + "%";
        document.getElementById('txt-enemy-hp').innerText = Math.max(0, curE.curHp) + " / " + curE.maxHp;
        document.getElementById('btl-player-hp').style.width = Math.max(0, (state.hp / state.maxHp) * 100) + "%";
        document.getElementById('txt-player-hp').innerText = Math.max(0, state.hp) + " / " + state.maxHp;
    }

    window.addEventListener('mousedown', e => { 
        if(!state.isBattle && document.getElementById('shop-ui').style.display === 'none') { 
            state.tX = state.wX + (e.clientX - window.innerWidth/2); 
            state.tY = state.wY + (e.clientY - window.innerHeight/2); 
        } 
    });

    init();
</script>
</body>
</html>